{% comment %}
  set-presentation-order: set an array containing the presentation labels, in agenda order
    Also sets a matching module-order and presenter-order arrays, for completeness

  arguments:
    `agenda`: CSV table with agenda data
    `presentations`: associative array mapping shorthand labels for presentations to their titles

  outputs:
    `presentation-order`
    `module-order`
    `presenter-order`

  agenda table structure requirements:
    A column headed `Title` containing the label of the presentation (referencing the presentations argument) 
    A column headed `Module` containing the module number used to help keep things in order
    The `Module` column should be blank if the `Title` column contains something other than a presentation label
      If there is no `Module` column, or the numbering provided doesn't match with the number of presentation found,
      the presentations are automatically assigned module numbers in sequence, starting with 1.
    A column headed `Presenter` containing the github id of the presenter(s).  Multiple presenters are supported.

{% endcomment %}

{%- assign presentation-order = "" | split: "," -%}
{%- assign module-order = "" | split: "," -%}
{%- assign presenter-order = "" | split: "," -%}
{%- for row in include.agenda -%}
  {%- if forloop.first -%}{%- continue -%}{%- endif -%}
  {%- for pair in row -%}
    {%- assign cell = pair[1] -%}
    {%- case pair[0] -%}
      {%- when "Title" -%}
        {%- if my-presentations[cell] -%}
          {%- assign presentation-order = presentation-order | push: cell -%}
        {%- endif -%}
      {%- when "Module" -%}
        {%- if cell -%}
          {%- assign module-order = module-order | push: cell -%}
        {%- endif -%}
      {%- when "Presenter" -%}
        {%- if cell -%}
          {%- assign cellnospace = cell | remove: " " -%}
          {%- unless cellnospace == "all" -%}
            {%- assign presenter-order = presenter-order | push: cellnospace -%}
          {%- endunless -%}
        {%- endif -%}
    {%- endcase -%}
  {%- endfor -%}
{%- endfor -%}
{%- if module-order.size != presentation-order.size -%}
  {%- for p in presentation-order -%}
    {%- assign module-order = module-order | push: forloop.index -%}
  {%- endfor -%}
{%- endif -%}
